# vim: ft=zsh

#
# Options
#

setopt AUTO_CD
setopt AUTO_PUSHD
setopt EXTENDED_GLOB

#
# Bindings
#

# Use vim-style key bindings
bindkey -v
bindkey -v '^?' backward-delete-char
autoload edit-command-line
zle -N edit-command-line
bindkey -M vicmd 'v' edit-command-line

#
# Autoload Functions
#
for func in "$HOME"/.local/functions/*(N:t); do
  autoload -Uz $func
done

#
# Autocomplete
#

autoload -Uz compinit
compinit
# autoload -U +x bashcompinit && bashcompinit

# Enable path completion for multiple segments
zstyle ':completion:*' completer _complete _ignored _approximate

# Syntax Highlighting
source "$XDG_STATE_HOME"/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh # broken syntax highlighting

#
# Third-party
#

# Starship
eval "$(starship init zsh)"
# broken syntax highlighting

# SSH Agent
eval $(ssh-agent -s) &>/dev/null

# asdf
. $(brew --prefix asdf)/libexec/asdf.sh

#
# Custom Functions
#

function search-aliases () {
  if (( $#argv )); then
    value="--value $argv[@]"
  else
    value=""
  fi
  alias |
    gum filter --select-if-one ${(z)value} |
    cut -d '=' -f 2 |
    read cmd
  if [[ -n "$cmd" ]]; then
    cmd=${cmd#[\']}
    cmd=${cmd%[\']}
    print -z "$cmd"
  fi
}

#
# Aliases
#

# Global

alias -g P='| ${(z)PAGER}'
alias -g HP='--help 2>&1 | ${(z)PAGER}'
alias -g HF='--help 2>&1 | gum filter'

# Suffix


# Normal

alias brewh='brew home'
alias brewi='brew install'
alias brews='brew search'
alias brewx='brew uninstall'
alias caskh='brew home --cask'
alias caski='brew install --cask'
alias casks='brew search --cask'
alias caskx='brew uninstall --cask'
alias cm='chezmoi'
alias cma='chezmoi add'
alias cmd='chezmoi diff'
alias cme='chezmoi edit'
alias cmew='chezmoi edit --watch'
alias cmm='chezmoi merge'
alias cmr='chezmoi re-add'
alias cmri='chezmoi re-add --interactive'
alias cms='chezmoi status'
alias cmsy='chezmoi-sync'
alias cmx='chezmoi destroy'
alias e='${(z)VISUAL:-${(z)EDITOR}'
alias gb='git branch'
alias gbv='git branch -v'
alias gcam='git commit -am'
alias gcm='git commit -m'
alias gco='git checkout'
alias gf='git fetch'
alias gfa='git fetch --all'
alias gfap='git fetch --all --prune'
alias gfm='git pull'
alias giA='git add -A'
alias gia='git add'
alias gp='git push'
alias gpp='git pull && git push'
alias gws='git status -s'
alias gwS='git status'
alias lg='lazygit'
alias ls='eza'
alias sa='search-aliases'
alias ssh-add-all='ssh-add --apple-use-keychain "$HOME"/.ssh/id_^*.pub'
alias sshc='sed -e '\''/^Host/!d'\'' -e '\''s/^Host //'\'' ~/.ssh/config | gum filter | read host; ssh $host'
alias tmux.conf='chezmoi edit --watch ~/.config/tmux.conf; tmux source-file ~/.config/tmux.conf'
alias tmuxa='tmux-control attach'
alias tmuxl='tmux-control list'
alias tx='tmux-control'
alias txa='tmuxa'
alias txe='tmux-control edit'
alias txl='tmuxl'
alias zshenv='chezmoi edit ~/.zshenv; exec zsh'
alias zshrc='chezmoi edit ~/.zshrc; exec zsh'
