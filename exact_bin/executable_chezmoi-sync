#!/usr/bin/env zsh -euo pipefail

local readd=()
local destroy=()

while read -r stat file; do
  case $stat in
    MM)
      gum log -l info --prefix "re-add" "$file"
      readd+=$file
      ;;
    DA)
      gum log -l warn --prefix "destroy" "$file"
      destroy+=$file
      ;;
    *)
      gum log -l error --prefix "ERROR" "unknown status: $stat"
      gum log --prefix "$file"
      ;;
  esac
done <<< $(chezmoi status)

if gum confirm "Proceed"; then
  chezmoi re-add "${readd[@]}"
  chezmoi destroy "${destroy[@]}"
fi

