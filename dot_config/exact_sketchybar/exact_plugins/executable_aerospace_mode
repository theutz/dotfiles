#!/usr/bin/env nu

let theme = (nu -e 'rose-pine | to json' | complete | $in.stdout | from json)

def "into argb" [--alpha (-a): string = "FF"]: string -> string {
  $in | str replace "#" "" | ["0x" $alpha $in] | str join
}

aerospace list-modes --current
| [
  --animate quadratic 10
  --bar color=(match ($in) { main => $theme.base, _ => $theme.love } | into argb -a "88")
  --set aerospace_mode
  icon.highlight=(match ($in) { main => "off", _ => "on" })
  label.drawing=(match ($in) { main => "off", _ => "on" })
  label=($in)
]
| each { into string }
| run-external sketchybar ...$in
