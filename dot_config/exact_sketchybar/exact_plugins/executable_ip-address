#!/usr/bin/env nu
# vim: ft=nu

plugin use query

let data = http get https://am.i.mullvad.net
| query web --query '.results p:nth-child(2)'
| flatten
| get 0
| parse --regex r#'IP address: (?<ip>.*?), (?<location>.*)'#
| update cells { str trim }
| first

[
  --animate sin 10
] | if ($data | is-not-empty) {
  append [
    --set ipaddress
    icon.highlight=off
    label=($data.ip)
    label.drawing=on

    --set iplocation
    icon.highlight=off
    drawing=on
    label=($data.location)
  ]
} else {
  [
    --set ipaddress
    icon.highlight=on
    
    --set iplocation
    drawing=off
  ]
}
| sketchybar ...$in

