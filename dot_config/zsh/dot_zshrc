#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/zprezto/init.zsh" ]]; then
	source "${ZDOTDIR:-$HOME}/zprezto/init.zsh"
fi

# Customize to your needs...

# -----------------
# --  Variables  --
# -----------------

export COMPOSER_HOME="${XDG_CONFIG_HOME:=$HOME}/composer"
export KEYTIMEOUT=1
export MANPAGER='nvim +Man!'
export MANWIDTH=999
export RANGER_LOAD_DEFAULT_RC=false
export TERM="screen-256color"

if [[ "$OSTYPE" == darwin* ]]; then
	export CPATH=/opt/homebrew/include
	export LIBRARY_PATH=/opt/homebrew/lib
fi

# -----------------
# --  Functions  --
# -----------------

source "$ZDOTDIR/funcs.zsh"

# ---------------
# --  Aliases  --
# ---------------

source "$ZDOTDIR/aliases.zsh"

# ----------------
# --  Bindings  --
# ----------------

source "$ZDOTDIR/bindings.zsh"

# --------------
# --  zoxide  --
# --------------

function _load_zoxide {
	eval "$(zoxide init zsh)"
}
zsh-defer _load_zoxide

# ------------
# --  asdf  --
# ------------

. "$HOME/.asdf/asdf.sh"

# ---------------
# --  chezmoi  --
# ---------------

function _load_chezmoi {
	source <(chezmoi completion zsh)
}
zsh-defer _load_chezmoi

# -------------
# --  broot  --
# -------------

function _load_broot {
	source <(broot --print-shell-function zsh)
	broot --set-install-state installed
}
zsh-defer _load_broot

# -------------
# --  atuin  --
# -------------

function _load_atuin {
	eval "$(atuin init zsh)"
}
zsh-defer _load_atuin

# -----------
# --  fzf  --
# -----------

[ -f ~/.fzf.zsh ] && . $HOME/.fzf.zsh

# ---------
# -- gpg --
# ---------

if [[ -z "$GPG_AGENT_INFO" ]]; then
	GPG_AGENT_INFO="$HOME/.gnupg/S.gpg-agent:$(pgrep gpg-agent):1"
	export GPG_AGENT_INFO
fi

if [[ -z "$GPG_TTY" ]]; then
	GPG_TTY="$(tty)"
	export GPG_TTY
fi

gpg-connect-agent updatestartuptty /bye >/dev/null

# ----------------
# --  keychain  --
# ----------------

eval $(keychain --eval --agents gpg,ssh --inherit any id_ed25519 FD235DFD 48B95546)

# ------------
# --  rust  --
# ------------

[ -f ~/.cargo/env ] && source "$HOME"/.cargo/env

# -----------
# --  bob  --
# -----------

source <(bob complete zsh)

# ----------------
# --  starship  --
# ----------------

eval "$(starship init zsh)"

# --------------
# --  direnv  --
# --------------

eval "$(direnv hook zsh)"

# vim: ft=sh
