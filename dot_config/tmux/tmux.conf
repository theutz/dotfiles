#
# Global
#

set -g mouse on
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -g destroy-unattached off
set -g detach-on-destroy off
set -g aggressive-resize on
set -g base-index 1
set -g pane-base-index 1
set -g status-keys vi
set -g mode-keys vi
set -g renumber-windows on
set -g set-titles on
set -g pane-border-indicators both
set -g pane-border-lines heavy
set -g window-status-separator ""

#
# Status Formats & Styles
#

set -g @cap-start ""
set -g @cap-end ""
set -g @cap-start-half ""
set -g @cap-end-half ""
set -g @separator-left ""
set -g @separator-right ""
set -g @window-status-format "#{?window_active,#[bold],}#I#[nobold] #{@separator-right} #W"
set -g @window-flags "#{?window_marked_flag, ,}#{?window_zoomed_flag,󱉶 ,}#{?window_bell_flag,󰵙 ,}#{?window_last_flag,m,}"
set -ga @window-status-format " #{@separator-right} #{E:@window-flags}"
set -g status 3
set -g status-format[0] ""
set -g status-left " #{@cap-start}#[bg=blue fg=black] 󰬚  #[bold]#S#[nobold]"
set -ga status-left " #{@separator-right} 󰉋 #{session_path}#[default]#{@cap-end}"
set -g status-right "#{W:#{E:window-status-format} ,#{E:window-status-current-format} } "
set -g window-status-format "#[fg=yellow]#[push-default]#{@cap-start-half} #{E:@window-status-format}#{@cap-end-half}#[default]"
set -g window-status-current-format "#[fg=red]#[push-default]#{@cap-start}#[bg=red fg=black] #{E:@window-status-format} "
set -ga window-status-current-format "#[default]#{@cap-end}"
set -g status-format[1] "#{E:status-left}#[align=right]#{E:status-right}"
set -g status-style "fg=blue bg=default"
set -g window-status-current-style "fg=red bg=red"
set -g status-position top

# set -g message-command-style "bg=#{PALETTE_1},fg=#{PALETTE_2},italics"
# set -g message-style "bg=#{PALETTE_2},fg=#{PALETTE_1},bright"
# set -g pane-active-border-style "bg=default,fg=#{PALETTE_1},nodim"
# set -g pane-border-format " #{?pane_active,󱗜 #[underscore],󱗝 }#[bold]#{pane_current_path}#[nounderscore] #[italics]#{pane_current_command}#[default] "
# set -g pane-border-status top
# set -g pane-border-style "bg=default,fg=#{PALETTE_1},dim"
# set -g status 3
# set -g status-justify absolute-centre
# set -g status-left "#{@segment-start}󰽘 #S#{@segment-end}"
# set -g status-left-length 60
# set -g status-left-style ""
# set -g status-position bottom
# set -g status-right "#{@segment-start}󱩊 #H#{@segment-end}"
# set -g status-right-length 60
# set -g status-right-style ""
# set -g status-style ""
# set -g window-status-current-format "#{@segment-start}#I: #W #F#{@segment-end}"
# set -g window-status-current-style ""
# set -g window-status-format "#{@segment-start}#I: #W #F#{@segment-end}"
# set -g window-status-style ""

#
# Plugins
#
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'aserowy/tmux.nvim'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'sainnhe/tmux-fzf'

# Install tpm & plugins if they don't exist
if "test ! -d ~/.config/tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm && ~/.config/tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'

# Key binding overrides
bind-key -N "Reload tmux config" r source ~/.config/tmux/tmux.conf \; display-message "Tmux config reloaded!"
bind-key -N "Clear screen" C-l send-keys 'C-l'
bind-key -N "List all keys" / list-keys

# Popuup key table
bind-key -N "Switch to popup keys table" g switch-client -Tpopup
bind-key -N "lazygit" -T popup g display-popup -w 80% -h 80% -E lazygit
bind-key -N "nb" -T popup n display-popup -w 80% -h 80% -E nb shell
bind-key -N "zdotdir" -T popup z display-popup -w 80% -h 80% -E nvim $ZDOTDIR
bind-key -N "tmux" -T popup t display-popup -w 80% -h 80% -E nvim ~/.config/tmux/tmux.conf

# Key Mode
set -g status-keys vi
set -g mode-keys vi
