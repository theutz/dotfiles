{{- /* vim: ft=sh.tmpl */ -}}
#!/bin/sh

{{ template "chezmoi-cmd.sh" . -}}

{{ $file := "id_ed25519" -}}
{{ $src := joinPath .chezmoi.sourceDir "private_dot_skm" "default" (print "private_encrypted_" $file ".age") -}}
{{ $dir := joinPath .chezmoi.homeDir ".ssh" -}}
{{ $dest := joinPath $dir $file -}}

if [ ! -d "{{ $dir }}" ]; then
  mkdir -p "{{ $dir }}"
  chmod 0700 "{{ $dir }}"
fi

if [ ! -f "{{ $dest }}" ]; then
  $chezmoi age decrypt \
    --passphrase \
    --output "{{ $dest }}" \
    "{{ $src }}"
fi
