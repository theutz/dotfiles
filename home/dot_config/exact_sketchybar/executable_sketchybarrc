#!/usr/bin/env bash

PATH="$HOME/bin:$PATH" # Append path so I can use dracula colors
PLUGIN_DIR="$CONFIG_DIR/plugins"
FONT="BlexMono Nerd Font Propo"

# Setup bar
args=(
	--bar
	position=top
	height=40
	blur_radius=30
	color="$(dracula -s -a 88 background)"
)
sketchybar "${args[@]}"

# Setup defaults
args=(
	--default
	padding_left=5
	padding_right=5
	icon.font="${FONT}:Normal:18.0"
	label.font="${FONT}:Normal:16.0"
	icon.color="$(dracula -s purple)"
	label.color="$(dracula -s foreground)"
	icon.padding_left=4
	icon.padding_right=4
	label.padding_left=4
	label.padding_right=4
	alias.color="$(dracula -s cyan)"
	alias.scale=1.0
)

# Setup  AeroSpace spaces
args+=(
	--add event aerospace_workspace_change
	--add item aerospace left
	--set aerospace
	script="$PLUGIN_DIR/aerospace.sh"
	drawing=off
	--subscribe aerospace aerospace_workspace_change
)
for sid in $(aerospace list-workspaces --all); do
	args+=(
		--add item space."$sid" left
		--set space."$sid"
		background.color="$(dracula -s -a 88 green)"
		label.color="$(dracula -s comment)"
		icon.color="$(dracula -s comment)"
		background.corner_radius=5
		background.height=24
		background.drawing=off
		label="$sid"
		click_script="aerospace workspace $sid"
	)
done

# Setup chevron
args+=(
	--add item chevron left
	--set chevron icon=""
	label.drawing=off
	icon.color="$(dracula -s red)"
	icon.padding_left=12
)

# Setup front app
args+=(
	--add item front_app left
	--set front_app
	icon.drawing=off
	script="$PLUGIN_DIR/front_app.sh"
	label.color="$(dracula -s pink)"
	--subscribe front_app front_app_switched
)

# Setup AeroSpace Modes
args+=(
	--add event aerospace_mode_change
	--add item aerospace.mode left
	--subscribe aerospace.mode aerospace_mode_change
	--set aerospace.mode
	drawing=off
	icon=""
	icon.color="$(dracula -s cyan)"
	label.color="$(dracula -s yellow)"
	script="$PLUGIN_DIR/aerospace_mode.sh"
)

# Setup clock
args+=(
	--add item clock right
	--set clock
	update_freq=10
	icon= script="$PLUGIN_DIR/clock.sh"
)

# Setup volume
args+=(
	--add item volume right
	--set volume script="$PLUGIN_DIR/volume.sh"
	--subscribe volume volume_change
)

# Setup battery
args+=(
	--add item battery right
	--set battery
	update_freq=120
	script="$PLUGIN_DIR/battery.sh"
	--subscribe battery system_woke power_source_change
)

aliases=(
	"Tailscale,Item-0"
	"TextInputMenuAgent,Item-0"
	"Control Center,FocusModes"
	"AeroSpace,Item-0"
)
for alias in "${aliases[@]}"; do
	args+=(
		--add alias "$alias" right
		--set "$alias"
		background.padding_left=0
		background.padding_right=8
		label.drawing=off
		icon.drawing=off
	)
done
sketchybar "${args[@]}"

##### Force all scripts to run the first time (never do this in a script) #####
sketchybar --update
